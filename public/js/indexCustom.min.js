function setAttributes(e,t){for(var a in t)e.setAttribute(a,t[a])}function init_sidebar(){var e=function(){$RIGHT_COL.css("min-height",$(window).height());var e=$BODY.outerHeight(),t=$BODY.hasClass("footer_fixed")?-10:$FOOTER.height(),a=$LEFT_COL.eq(1).height()+$SIDEBAR_FOOTER.height(),n=e<a?a:e;n-=$NAV_MENU.height()+t,$RIGHT_COL.css("min-height",n)};$SIDEBAR_MENU.find("a").on("click",function(t){var a=$(this).parent();a.is(".active")?(a.removeClass("active active-sm"),$("ul:first",a).slideUp(function(){e()})):(a.parent().is(".child_menu")?$BODY.is(".nav-sm")&&($SIDEBAR_MENU.find("li").removeClass("active active-sm"),$SIDEBAR_MENU.find("li ul").slideUp()):($SIDEBAR_MENU.find("li").removeClass("active active-sm"),$SIDEBAR_MENU.find("li ul").slideUp()),a.addClass("active"),$("ul:first",a).slideDown(function(){e()}))}),$MENU_TOGGLE.on("click",function(){$BODY.hasClass("nav-md")?($SIDEBAR_MENU.find("li.active ul").hide(),$SIDEBAR_MENU.find("li.active").addClass("active-sm").removeClass("active")):($SIDEBAR_MENU.find("li.active-sm ul").show(),$SIDEBAR_MENU.find("li.active-sm").addClass("active").removeClass("active-sm")),$BODY.toggleClass("nav-md nav-sm"),e(),$(".dataTable").each(function(){$(this).dataTable().fnDraw()})}),$SIDEBAR_MENU.find("a[href='"+CURRENT_URL+"']").parent("li").addClass("current-page"),$SIDEBAR_MENU.find("a").filter(function(){return this.href==CURRENT_URL}).parent("li").addClass("current-page").parents("ul").slideDown(function(){e()}).parent().addClass("active"),$(window).smartresize(function(){e()}),e(),$.fn.mCustomScrollbar&&$(".menu_fixed").mCustomScrollbar({autoHideScrollbar:!0,theme:"minimal",mouseWheel:{preventDefault:!0}})}function init_panel(){$(".collapse-link").on("click",function(){var e=$(this).closest(".x_panel"),t=$(this).find("i"),a=e.find(".x_content");e.attr("style")?a.slideToggle(200,function(){e.removeAttr("style")}):(a.slideToggle(200),e.css("height","auto")),t.toggleClass("fa-chevron-up fa-chevron-down")}),$(".close-link").click(function(){$(this).closest(".x_panel").remove()})}function init_tooltip(){$("[data-toggle='tooltip']").tooltip({container:"body"})}function failEventListener(e,t,a){document.getElementById("failChart").addEventListener("click",function(n){var i=e.getElementsAtEventForMode(n,"index",{intersect:!1}),o=document.createDocumentFragment(),r=document.getElementById("failProject");if(0!=i.length){for(;r.hasChildNodes();)r.removeChild(r.firstChild);var l=i[0]._index;document.getElementById("failProjectTitle").innerText="Project 상세 - "+t[l];for(var s=0;s<a[0][l];s++){var d=a[1][l][s],m=document.createElement("li"),c=document.createElement("a"),u=document.createElement("i");m.setAttribute("class","media event"),c.setAttribute("class","pull-left border-pass profile_thumb"),u.setAttribute("class","fa fa-user pass"),c.appendChild(u),m.appendChild(c);var f=document.createElement("div");f.setAttribute("class","media-body");var p=document.createElement("a");setAttributes(p,{id:"failTitle"+s,class:"title"}),p.innerText=d.pj_name;var h=document.createElement("p"),g=d.pass+d.skip+d.fail,v=Math.round(d.fail/g*100).toFixed(1);h.setAttribute("id","failp"+s),h.innerText=g+"개 TC중 "+d.fail+"개 TC Fail ("+v+"%)";var C=document.createElement("p"),E=document.createElement("small");E.setAttribute("id","failauthor"+s),E.innerText=d.pj_author,C.appendChild(E),f.appendChild(p),f.appendChild(h),f.appendChild(C),m.appendChild(f),o.appendChild(m)}document.getElementById("failProject").appendChild(o)}})}function change_failChart(e,t){document.getElementById("failChartDiv").removeChild(document.getElementById("failChart"));var a=document.createElement("canvas");a.setAttribute("id","failChart"),document.getElementById("failChartDiv").appendChild(a);for(var n=document.getElementById("failProject");n.hasChildNodes();)n.removeChild(n.firstChild);var i=new XMLHttpRequest;i.onreadystatechange=function(){404===i.status?window.location="/404":500===i.status&&(window.location="/500")},i.open("GET","/getData/getFailChartData?start="+e+"&end="+t,!0),i.send(),i.addEventListener("load",function(){var e=JSON.parse(i.responseText);init_failChart(e,e.diff,e.end)})}function init_failChart(e,t,a){if(document.getElementById("failChart")&&"undefined"!=typeof Chart){for(var n=[],i=[[],[]],o=t;o>-1;o--)i[0][o]=0,i[1][o]=[],n.push(moment(a,"YYYY/MM/DD").subtract(o,"day").format("MM/DD"));e.data.forEach(function(e){1*e.failrate>10&&(i[0][n.indexOf(e.start_t.slice(5,10))]++,i[1][n.indexOf(e.start_t.slice(5,10))].push(e))}),failEventListener(new Chart(document.getElementById("failChart"),{type:"bar",data:{labels:n,datasets:[{label:"Project수",backgroundColor:"rgba(102, 194, 255, 0.7)",data:i[0]}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]},legend:!1}}),n,i)}}function init_platformChart(e){if(document.getElementById("platformChartDiv")&&"undefined"!=typeof Chart){for(var t=0;t<3;t++)document.getElementById("plat_info"+t).innerHTML+="("+e.platResult[2][t]+"%)";new Chart(document.getElementById("platformChartDiv"),{type:"doughnut",data:{labels:["PC Web","Mobile Web","Mobile App"],datasets:[{data:e.platResult[1],backgroundColor:["rgba(102, 194, 255, 0.7)","rgba(255, 115, 115, 0.7)","rgba(130, 130, 130, 0.7)"],hoverBackgroundColor:["rgba(102, 194, 255, 1.0)","rgba(255, 115, 115, 1.0)","rgba(130, 130, 130, 1.0)"],label:["PC Web","Mobile Web","Mobile App"]}]},options:{legend:!1}})}}function init_indexData(){console.log("init_indexData");var e=new XMLHttpRequest;e.onreadystatechange=function(){404===e.status?window.location="/404":500===e.status&&(window.location="/500")},e.open("GET","/getData/getIndexData",!0),e.send(),e.addEventListener("load",function(){var t=JSON.parse(e.responseText),a=t.data.reduce(function(e,t,a,n){return e+1*t.passrate},0);document.getElementById("allCnt").innerText=t.allCnt,document.getElementById("todayCnt").innerText=t.todayCnt,document.getElementById("passCnt").innerText=Math.round(a/t.data.length).toFixed(1)+"%",$("#todayProject").html(moment().format("YYYY.MM.DD")+" 기준");for(var n=0;n<t.teamResult[0].length;n++)document.getElementById("teamleft"+n).innerText=t.teamResult[0][n],document.getElementById("teamright"+n).innerText=t.teamResult[1][n]+" 개",setAttributes(document.getElementById("teamcenter"+n),{"aria-valuenow":t.teamResult[1][n],"aria-valuemax":t.allCnt,style:"width: "+t.teamResult[2][n]+"%"});init_platformChart(t),init_failChart(t,6,moment().format("YYYY/MM/DD"))})}function init_compose(){void 0!==$.fn.slideToggle&&(console.log("init_compose"),$("#compose, .compose-close").click(function(){$(".compose").slideToggle()}))}function init_daterangepicker(){if(void 0!==$.fn.daterangepicker){console.log("init_daterangepicker");var e={startDate:moment().subtract(29,"days"),endDate:moment(),minDate:"01/01/2017",maxDate:moment().add(1,"years"),showDropdowns:!0,timePicker:!1,timePickerIncrement:1,ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},opens:"left",buttonClasses:["btn btn-default"],applyClass:"btn-small btn-primary",cancelClass:"btn-small",format:"MM/DD/YYYY",separator:" to ",locale:{applyLabel:"Submit",cancelLabel:"Clear",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1}};$("#reportrange span").html(moment().subtract(6,"days").format("MMMM D, YYYY")+" - "+moment().format("MMMM D, YYYY")),$("#reportrange").daterangepicker(e,function(e,t,a){$("#reportrange span").html(e.format("MMMM D, YYYY")+" - "+t.format("MMMM D, YYYY"))}),$("#reportrange").on("apply.daterangepicker",function(e,t){change_failChart(t.startDate.format("YYYY/MM/DD HH:mm:ss"),t.endDate.format("YYYY/MM/DD HH:mm:ss"))})}}!function(e,t){var a=function(e,t,a){var n;return function(){var i=this,o=arguments;n?clearTimeout(n):a&&e.apply(i,o),n=setTimeout(function(){a||e.apply(i,o),n=null},t||100)}};jQuery.fn[t]=function(e){return e?this.bind("resize",a(e)):this.trigger(t)}}(jQuery,"smartresize"),"undefined"!=typeof NProgress&&NProgress.start();var CURRENT_URL=window.location.href.split("#")[0].split("?")[0],$BODY=$("body"),$MENU_TOGGLE=$("#menu_toggle"),$SIDEBAR_MENU=$("#sidebar-menu"),$SIDEBAR_FOOTER=$(".sidebar-footer"),$LEFT_COL=$(".left_col"),$RIGHT_COL=$(".right_col"),$NAV_MENU=$(".nav_menu"),$FOOTER=$("footer");$(document).ready(function(){init_sidebar(),init_panel(),init_tooltip()}),$(document).ready(function(){init_compose(),init_indexData(),init_daterangepicker()}),$(window).on("load",function(){NProgress.done()});