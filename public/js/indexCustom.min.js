function setAttributes(t,e){for(var a in e)t.setAttribute(a,e[a])}function init_sidebar(){var t=function(){$RIGHT_COL.css("min-height",$(window).height());var t=$BODY.outerHeight(),e=$BODY.hasClass("footer_fixed")?-10:$FOOTER.height(),a=$LEFT_COL.eq(1).height()+$SIDEBAR_FOOTER.height(),n=t<a?a:t;n-=$NAV_MENU.height()+e,$RIGHT_COL.css("min-height",n)};$SIDEBAR_MENU.find("a").on("click",function(e){var a=$(this).parent();a.is(".active")?(a.removeClass("active active-sm"),$("ul:first",a).slideUp(function(){t()})):(a.parent().is(".child_menu")?$BODY.is(".nav-sm")&&($SIDEBAR_MENU.find("li").removeClass("active active-sm"),$SIDEBAR_MENU.find("li ul").slideUp()):($SIDEBAR_MENU.find("li").removeClass("active active-sm"),$SIDEBAR_MENU.find("li ul").slideUp()),a.addClass("active"),$("ul:first",a).slideDown(function(){t()}))}),$MENU_TOGGLE.on("click",function(){$BODY.hasClass("nav-md")?($SIDEBAR_MENU.find("li.active ul").hide(),$SIDEBAR_MENU.find("li.active").addClass("active-sm").removeClass("active")):($SIDEBAR_MENU.find("li.active-sm ul").show(),$SIDEBAR_MENU.find("li.active-sm").addClass("active").removeClass("active-sm")),$BODY.toggleClass("nav-md nav-sm"),t(),$(".dataTable").each(function(){$(this).dataTable().fnDraw()})}),$SIDEBAR_MENU.find("a[href='"+CURRENT_URL+"']").parent("li").addClass("current-page"),$SIDEBAR_MENU.find("a").filter(function(){return this.href==CURRENT_URL}).parent("li").addClass("current-page").parents("ul").slideDown(function(){t()}).parent().addClass("active"),$(window).smartresize(function(){t()}),t(),$.fn.mCustomScrollbar&&$(".menu_fixed").mCustomScrollbar({autoHideScrollbar:!0,theme:"minimal",mouseWheel:{preventDefault:!0}})}function init_panel(){$(".collapse-link").on("click",function(){var t=$(this).closest(".x_panel"),e=$(this).find("i"),a=t.find(".x_content");t.attr("style")?a.slideToggle(200,function(){t.removeAttr("style")}):(a.slideToggle(200),t.css("height","auto")),e.toggleClass("fa-chevron-up fa-chevron-down")}),$(".close-link").click(function(){$(this).closest(".x_panel").remove()})}function init_tooltip(){$("[data-toggle='tooltip']").tooltip({container:"body"})}function updateProjectDetail(t,e,a){return function(){for(var n=document.createDocumentFragment(),i=document.getElementById("failProject");i.hasChildNodes();)i.removeChild(i.firstChild);document.getElementById("failProjectTitle").innerText="Project 상세 - "+t[a];for(var o=0;o<e[0][a];o++){var r=e[1][a][o],l=document.createElement("li"),s=document.createElement("a"),d=document.createElement("i");l.setAttribute("class","media event"),s.setAttribute("class","pull-left border-pass profile_thumb"),d.setAttribute("class","fa fa-archive pass"),s.appendChild(d),l.appendChild(s);var c=document.createElement("div");c.setAttribute("class","media-body");var m=document.createElement("a");setAttributes(m,{id:"failTitle"+o,class:"title"}),m.innerText=r.pj_name;var u=document.createElement("p"),f=r.pass+r.skip+r.fail,p=Math.round(r.fail/f*100).toFixed(1);u.setAttribute("id","failp"+o),u.innerText=f+"개 TC중 "+r.fail+"개 TC Fail ("+p+"%)";var h=document.createElement("p"),g=document.createElement("small");g.setAttribute("id","failauthor"+o),g.innerText=r.pj_author,h.appendChild(g),c.appendChild(m),c.appendChild(u),c.appendChild(h),l.appendChild(c),n.appendChild(l)}document.getElementById("failProject").appendChild(n)}}function init_failChart(t,e,a){if(document.getElementById("failChart")&&"undefined"!=typeof Chart){for(var n=[],i=[[],[]],o=e;o>-1;o--)i[0][o]=0,i[1][o]=[],n.push(moment(a,"YYYY/MM/DD").subtract(o,"day").format("MM/DD"));t.data.forEach(function(t){1*t.failrate>10&&(i[0][n.indexOf(t.start_t.slice(5,10))]++,i[1][n.indexOf(t.start_t.slice(5,10))].push(t))});var r=new Chart(document.getElementById("failChart"),{type:"bar",data:{labels:n,datasets:[{label:"Project수",backgroundColor:"rgba(102, 194, 255, 0.7)",data:i[0]}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]},legend:!1}});updateProjectDetail(n,i,e)(),document.getElementById("failChart").addEventListener("click",function(t){var e=r.getElementsAtEventForMode(t,"index",{intersect:!1});0!=e.length&&updateProjectDetail(n,i,e[0]._index)()})}}function change_failChart(t,e){document.getElementById("failChartDiv").removeChild(document.getElementById("failChart"));var a=document.createElement("canvas");a.setAttribute("id","failChart"),document.getElementById("failChartDiv").appendChild(a);for(var n=document.getElementById("failProject");n.hasChildNodes();)n.removeChild(n.firstChild);var i=new XMLHttpRequest;i.onreadystatechange=function(){404===i.status?window.location="/404":500===i.status&&(window.location="/500")},i.open("GET","/getData/getFailChartData?start="+t+"&end="+e,!0),i.send(),i.addEventListener("load",function(){var t=JSON.parse(i.responseText);init_failChart(t,t.diff,t.end)})}function init_platformChart(t){if(document.getElementById("platformChartDiv")&&"undefined"!=typeof Chart){for(var e=0;e<3;e++)document.getElementById("plat_info"+e).innerHTML+="("+t.platResult[2][e]+"%)";new Chart(document.getElementById("platformChartDiv"),{type:"doughnut",data:{labels:["PC Web","Mobile Web","Mobile App"],datasets:[{data:t.platResult[1],backgroundColor:["rgba(102, 194, 255, 0.7)","rgba(255, 115, 115, 0.7)","rgba(130, 130, 130, 0.7)"],hoverBackgroundColor:["rgba(102, 194, 255, 1.0)","rgba(255, 115, 115, 1.0)","rgba(130, 130, 130, 1.0)"],label:["PC Web","Mobile Web","Mobile App"]}]},options:{legend:!1}})}}function init_indexData(){console.log("init_indexData");var t=new XMLHttpRequest;t.onreadystatechange=function(){404===t.status?window.location="/404":500===t.status&&(window.location="/500")},t.open("GET","/getData/getIndexData",!0),t.send(),t.addEventListener("load",function(){var e=JSON.parse(t.responseText),a=e.data.reduce(function(t,e,a,n){return t+1*e.passrate},0);document.getElementById("allCnt").innerText=e.allCnt,document.getElementById("todayCnt").innerText=e.todayCnt,0===e.data.length?document.getElementById("passCnt").innerText="0.0%":document.getElementById("passCnt").innerText=Math.round(a/e.data.length).toFixed(1)+"%",$("#todayProject").html(moment().format("YYYY.MM.DD")+" 기준");for(var n=0;n<e.teamResult[0].length;n++)document.getElementById("teamleft"+n).innerText=e.teamResult[0][n],document.getElementById("teamright"+n).innerText=e.teamResult[1][n]+" 개",setAttributes(document.getElementById("teamcenter"+n),{"aria-valuenow":e.teamResult[1][n],"aria-valuemax":e.allCnt,style:"width: "+e.teamResult[2][n]+"%"});init_platformChart(e),init_failChart(e,6,moment().format("YYYY/MM/DD"))})}function init_compose(){void 0!==$.fn.slideToggle&&(console.log("init_compose"),$("#compose, .compose-close").click(function(){$(".compose").slideToggle()}))}function init_daterangepicker(){if(void 0!==$.fn.daterangepicker){console.log("init_daterangepicker");var t={startDate:moment().subtract(29,"days"),endDate:moment(),minDate:"01/01/2017",maxDate:moment().add(1,"years"),showDropdowns:!0,timePicker:!1,timePickerIncrement:1,ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},opens:"left",buttonClasses:["btn btn-default"],applyClass:"btn-small btn-primary",cancelClass:"btn-small",format:"MM/DD/YYYY",separator:" to ",locale:{applyLabel:"Submit",cancelLabel:"Clear",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1}};$("#reportrange span").html(moment().subtract(6,"days").format("MMMM D, YYYY")+" - "+moment().format("MMMM D, YYYY")),$("#reportrange").daterangepicker(t,function(t,e,a){$("#reportrange span").html(t.format("MMMM D, YYYY")+" - "+e.format("MMMM D, YYYY"))}),$("#reportrange").on("apply.daterangepicker",function(t,e){change_failChart(e.startDate.format("YYYY/MM/DD HH:mm:ss"),e.endDate.format("YYYY/MM/DD HH:mm:ss"))})}}!function(t,e){var a=function(t,e,a){var n;return function(){var i=this,o=arguments;n?clearTimeout(n):a&&t.apply(i,o),n=setTimeout(function(){a||t.apply(i,o),n=null},e||100)}};jQuery.fn[e]=function(t){return t?this.bind("resize",a(t)):this.trigger(e)}}(jQuery,"smartresize"),"undefined"!=typeof NProgress&&NProgress.start();var CURRENT_URL=window.location.href.split("#")[0].split("?")[0],$BODY=$("body"),$MENU_TOGGLE=$("#menu_toggle"),$SIDEBAR_MENU=$("#sidebar-menu"),$SIDEBAR_FOOTER=$(".sidebar-footer"),$LEFT_COL=$(".left_col"),$RIGHT_COL=$(".right_col"),$NAV_MENU=$(".nav_menu"),$FOOTER=$("footer");$(document).ready(function(){init_sidebar(),init_panel(),init_tooltip()}),$(document).ready(function(){init_compose(),init_indexData(),init_daterangepicker()}),$(window).on("load",function(){NProgress.done()});