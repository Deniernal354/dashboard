function setAttributes(e,t){for(var a in t)e.setAttribute(a,t[a])}!function(e,t){jQuery.fn[t]=function(e){return e?this.bind("resize",(a=e,function(){var e=this,t=arguments;o?clearTimeout(o):i&&a.apply(e,t),o=setTimeout(function(){i||a.apply(e,t),o=null},n||100)})):this.trigger(t);var a,n,i,o}}(jQuery,"smartresize"),"undefined"!=typeof NProgress&&NProgress.start();var CURRENT_URL=window.location.href.split("#")[0].split("?")[0],$BODY=$("body"),$MENU_TOGGLE=$("#menu_toggle"),$SIDEBAR_MENU=$("#sidebar-menu"),$SIDEBAR_FOOTER=$(".sidebar-footer"),$LEFT_COL=$(".left_col"),$RIGHT_COL=$(".right_col"),$NAV_MENU=$(".nav_menu"),$FOOTER=$("footer");function init_sidebar(){var a=function(){$RIGHT_COL.css("min-height",$(window).height());var e=$BODY.outerHeight(),t=$BODY.hasClass("footer_fixed")?-10:$FOOTER.height(),a=$LEFT_COL.eq(1).height()+$SIDEBAR_FOOTER.height(),n=e<a?a:e;n-=$NAV_MENU.height()+t,$RIGHT_COL.css("min-height",n)};$SIDEBAR_MENU.find("a").on("click",function(e){var t=$(this).parent();t.is(".active")?(t.removeClass("active active-sm"),$("ul:first",t).slideUp(function(){a()})):(t.parent().is(".child_menu")?$BODY.is(".nav-sm")&&($SIDEBAR_MENU.find("li").removeClass("active active-sm"),$SIDEBAR_MENU.find("li ul").slideUp()):($SIDEBAR_MENU.find("li").removeClass("active active-sm"),$SIDEBAR_MENU.find("li ul").slideUp()),t.addClass("active"),$("ul:first",t).slideDown(function(){a()}))}),$MENU_TOGGLE.on("click",function(){$BODY.hasClass("nav-md")?($SIDEBAR_MENU.find("li.active ul").hide(),$SIDEBAR_MENU.find("li.active").addClass("active-sm").removeClass("active")):($SIDEBAR_MENU.find("li.active-sm ul").show(),$SIDEBAR_MENU.find("li.active-sm").addClass("active").removeClass("active-sm")),$BODY.toggleClass("nav-md nav-sm"),a(),$(".dataTable").each(function(){$(this).dataTable().fnDraw()})}),$SIDEBAR_MENU.find("a[href='"+CURRENT_URL+"']").parent("li").addClass("current-page"),$SIDEBAR_MENU.find("a").filter(function(){return this.href==CURRENT_URL}).parent("li").addClass("current-page").parents("ul").slideDown(function(){a()}).parent().addClass("active"),$(window).smartresize(function(){a()}),a(),$.fn.mCustomScrollbar&&$(".menu_fixed").mCustomScrollbar({autoHideScrollbar:!0,theme:"minimal",mouseWheel:{preventDefault:!0}})}function init_panel(){$(".collapse-link").on("click",function(){var e=$(this).closest(".x_panel"),t=$(this).find("i"),a=e.find(".x_content");e.attr("style")?a.slideToggle(200,function(){e.removeAttr("style")}):(a.slideToggle(200),e.css("height","auto")),t.toggleClass("fa-chevron-up fa-chevron-down")}),$(".close-link").click(function(){$(this).closest(".x_panel").remove()})}function init_tooltip(){$("[data-toggle='tooltip']").tooltip({container:"body"})}function commonXMLHttpRequest(){var e=new XMLHttpRequest;return e.onreadystatechange=function(){500===e.status&&(window.location="/auto/500")},e}function updateProjectDetail(p,h,g){return function(){for(var e=document.createDocumentFragment(),t=document.getElementById("failProject");t.hasChildNodes();)t.removeChild(t.firstChild);document.getElementById("failProjectTitle").innerText="Project 상세 - "+p[g];for(var a=0;a<h[0][g];a++){var n=h[1][g][a],i=document.createElement("li"),o=document.createElement("a"),r=document.createElement("i");i.setAttribute("class","media event"),o.setAttribute("class","pull-left border-pass profile_thumb"),r.setAttribute("class","fa fa-archive pass"),o.appendChild(r),i.appendChild(o);var l=document.createElement("div");l.setAttribute("class","media-body");var s=document.createElement("a");setAttributes(s,{id:"failTitle"+a,class:"title",title:n.pj_name}),s.innerText=n.pj_name;var d=document.createElement("p"),m=n.pass+n.skip+n.fail,c="Fail 비율: "+(n.fail/m*100).toFixed(1)+"%("+n.fail+"/"+m+")";setAttributes(d,{id:"failp"+a,title:c}),d.innerText=c;var u=document.createElement("p"),f=document.createElement("small");setAttributes(f,{id:"failauthor"+a,title:n.pj_author}),f.innerText=n.pj_author,u.appendChild(f),l.appendChild(s),l.appendChild(d),l.appendChild(u),i.appendChild(l),e.appendChild(i)}document.getElementById("failProject").appendChild(e)}}function init_failChart(e,t,a){if(document.getElementById("failChart")&&"undefined"!=typeof Chart){for(var n=[],i=[[],[]],o=t;-1<o;o--)i[0][o]=0,i[1][o]=[],n.push(moment(a,"YYYY/MM/DD").subtract(o,"day").format("MM/DD"));e.data.forEach(function(e){var t=n.indexOf(e.start_t.slice(5,10));10<1*e.failrate&&(i[0][t]++,i[1][t].push(e))});var r=new Chart(document.getElementById("failChart"),{type:"bar",data:{labels:n,datasets:[{label:"Project수",backgroundColor:"rgba(102, 194, 255, 0.7)",data:i[0]}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]},legend:!1}});updateProjectDetail(n,i,t)(),document.getElementById("failChart").addEventListener("click",function(e){var t=r.getElementsAtEventForMode(e,"index",{intersect:!1});0!=t.length&&updateProjectDetail(n,i,t[0]._index)()})}}function change_failChart(e,t){document.getElementById("failChartDiv").removeChild(document.getElementById("failChart"));var a=document.createElement("canvas");a.setAttribute("id","failChart"),document.getElementById("failChartDiv").appendChild(a);for(var n=document.getElementById("failProject");n.hasChildNodes();)n.removeChild(n.firstChild);var i=commonXMLHttpRequest();i.open("GET","/getData/getFailChartData?start="+e+"&end="+t,!0),i.send(),i.addEventListener("load",function(){var e=JSON.parse(i.responseText);init_failChart(e,e.diff,e.end)})}function init_platformChart(e){if(document.getElementById("platformChartDiv")&&"undefined"!=typeof Chart){for(var t=0;t<5;t++)document.getElementById("plat_info"+t).innerHTML+="("+e.platResult[1][t]+"개)";new Chart(document.getElementById("platformChartDiv"),{type:"doughnut",data:{labels:["PC Web(%)","PC App(%)","Mobile Web(%)","Mobile App(%)","API(%)"],datasets:[{data:e.platResult[2],backgroundColor:["rgba(102, 194, 255, 0.7)","rgba(155, 89, 182, 0.7)","rgba(255, 115, 115, 0.7)","rgba(255, 236, 80, 0.7)","rgba(180, 238, 180, 0.7)"],hoverBackgroundColor:["rgba(102, 194, 255, 1.0)","rgba(155, 89, 182, 1.0)","rgba(255, 115, 115, 1.0)","rgba(255, 236, 80, 1.0)","rgba(180, 238, 180, 1.0)"],label:["PC Web","PC App","Mobile Web","Mobile App","API"]}]},options:{legend:!1,responsive:!0,maintainAspectRatio:!1}})}}function init_indexData(){console.log("init_indexData");var n=commonXMLHttpRequest();n.open("GET","/getData/getIndexData",!0),n.send(),n.addEventListener("load",function(){var e=JSON.parse(n.responseText),t=e.data.reduce(function(e,t,a,n){return e+1*t.passrate},0);document.getElementById("allCnt").innerText=e.allCnt,document.getElementById("todayCnt").innerText=e.todayCnt,0===e.data.length?document.getElementById("passCnt").innerText="0.0%":document.getElementById("passCnt").innerText=(t/e.data.length).toFixed(1)+"%",$("#todayProject").html(moment().format("YYYY.MM.DD")+" 기준");for(var a=0;a<e.teamResult[0].length;a++)document.getElementById("teamleft"+a).innerText=e.teamResult[0][a],document.getElementById("teamright"+a).innerText=e.teamResult[1][a]+" 개",setAttributes(document.getElementById("teamcenter"+a),{"aria-valuenow":e.teamResult[1][a],"aria-valuemax":e.maxTeamCnt,style:"width: "+e.teamResult[2][a]+"%"});init_platformChart(e),init_failChart(e,6,moment().format("YYYY/MM/DD"))})}function init_compose(){void 0!==$.fn.slideToggle&&(console.log("init_compose"),$("#compose, .compose-close").click(function(){$(".compose").slideToggle()}))}function init_daterangepicker(){if(void 0!==$.fn.daterangepicker){console.log("init_daterangepicker");var e={startDate:moment().subtract(29,"days"),endDate:moment(),minDate:"01/01/2017",maxDate:moment().add(1,"years"),showDropdowns:!0,timePicker:!1,timePickerIncrement:1,ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},opens:"left",buttonClasses:["btn btn-default"],applyClass:"btn-small btn-primary",cancelClass:"btn-small",format:"MM/DD/YYYY",separator:" to ",locale:{applyLabel:"Submit",cancelLabel:"Clear",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1}};$("#reportrange span").html(moment().subtract(6,"days").format("MMMM D, YYYY")+" - "+moment().format("MMMM D, YYYY")),$("#reportrange").daterangepicker(e,function(e,t,a){$("#reportrange span").html(e.format("MMMM D, YYYY")+" - "+t.format("MMMM D, YYYY"))}),$("#reportrange").on("apply.daterangepicker",function(e,t){change_failChart(t.startDate.format("YYYY/MM/DD HH:mm:ss"),t.endDate.format("YYYY/MM/DD HH:mm:ss"))})}}$(document).ready(function(){init_sidebar(),init_panel(),init_tooltip()}),$(document).ready(function(){Chart.defaults.global.defaultFontSize=16,init_compose(),init_indexData(),init_daterangepicker()}),$(window).on("load",function(){NProgress.done()});